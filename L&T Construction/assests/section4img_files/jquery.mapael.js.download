!function(t){"object"==typeof exports?module.exports=t(require("jquery"),require("raphael"),require("jquery-mousewheel")):"function"==typeof define&&define.amd?define(["jquery","raphael","mousewheel"],t):t(jQuery,Raphael,jQuery.fn.mousewheel)}(function(O,B,t,b){"use strict";function a(t,e){var o=this;o.container=t,o.$container=O(t),o.options=o.extendDefaultOptions(e),o.zoomTO=0,o.zoomCenterX=0,o.zoomCenterY=0,o.previousPinchDist=0,o.zoomData={zoomLevel:0,zoomX:0,zoomY:0,panX:0,panY:0},o.currentViewBox={x:0,y:0,w:0,h:0},o.panning=!1,o.zoomAnimID=null,o.zoomAnimStartTime=null,o.zoomAnimCVBTarget=null,o.$map=O("."+o.options.map.cssClass,o.container),o.initialMapHTMLContent=o.$map.html(),o.$tooltip={},o.paper={},o.areas={},o.plots={},o.links={},o.legends={},o.mapConf={},o.customEventHandlers={},o.init()}var o,n,u="mapael";return a.prototype={MouseOverFilteringTO:120,panningFilteringTO:150,panningEndFilteringTO:50,zoomFilteringTO:150,resizeFilteringTO:150,init:function(){var o=this;if(""===o.options.map.cssClass||0===O("."+o.options.map.cssClass,o.container).length)throw new Error("The map class `"+o.options.map.cssClass+"` doesn't exists");if(o.$tooltip=O("<div>").addClass(o.options.map.tooltip.cssClass).css("display","none"),o.$map.empty().append(o.$tooltip),O[u]&&O[u].maps&&O[u].maps[o.options.map.name])o.mapConf=O[u].maps[o.options.map.name];else{if(!(O.fn[u]&&O.fn[u].maps&&O.fn[u].maps[o.options.map.name]))throw new Error("Unknown map '"+o.options.map.name+"'");o.mapConf=O.fn[u].maps[o.options.map.name],window.console&&window.console.warn&&window.console.warn("Extending $.fn.mapael is deprecated (map '"+o.options.map.name+"')")}if(o.paper=new B(o.$map[0],o.mapConf.width,o.mapConf.height),!0===o.isRaphaelBBoxBugPresent())throw o.destroy(),new Error("Can't get boundary box for text (is your container hidden? See #135)");o.$container.addClass(u),o.options.map.tooltip.css&&o.$tooltip.css(o.options.map.tooltip.css),o.setViewBox(0,0,o.mapConf.width,o.mapConf.height),o.options.map.width?o.paper.setSize(o.options.map.width,o.mapConf.height*(o.options.map.width/o.mapConf.width)):o.initResponsiveSize(),O.each(o.mapConf.elems,function(t){o.areas[t]={},o.areas[t].options=o.getElemOptions(o.options.map.defaultArea,o.options.areas[t]||{},o.options.legend.area),o.areas[t].mapElem=o.paper.path(o.mapConf.elems[t])}),o.options.map.beforeInit&&o.options.map.beforeInit(o.$container,o.paper,o.options),O.each(o.mapConf.elems,function(t){o.initElem(t,"area",o.areas[t])}),o.links=o.drawLinksCollection(o.options.links),O.each(o.options.plots,function(t){o.plots[t]=o.drawPlot(t)}),o.$container.on("zoom."+u,function(t,e){o.onZoomEvent(t,e)}),o.options.map.zoom.enabled&&o.initZoom(o.mapConf.width,o.mapConf.height,o.options.map.zoom),o.options.map.zoom.init!==b&&(o.options.map.zoom.init.animDuration===b&&(o.options.map.zoom.init.animDuration=0),o.$container.trigger("zoom",o.options.map.zoom.init)),o.createLegends("area",o.areas,1),o.createLegends("plot",o.plots,o.paper.width/o.mapConf.width),o.$container.on("update."+u,function(t,e){o.onUpdateEvent(t,e)}),o.$container.on("showElementsInRange."+u,function(t,e){o.onShowElementsInRange(t,e)}),o.initDelegatedMapEvents(),o.initDelegatedCustomEvents(),o.options.map.afterInit&&o.options.map.afterInit(o.$container,o.paper,o.areas,o.plots,o.options),O(o.paper.desc).append(" and Mapael "+o.version+" (https://www.vincentbroute.fr/mapael/)")},destroy:function(){var o=this;o.$container.off("."+u),o.$map.off("."+u),o.onResizeEvent&&O(window).off("resize."+u,o.onResizeEvent),o.$map.empty(),o.$map.html(o.initialMapHTMLContent),O.each(o.legends,function(e){O.each(o.legends[e],function(t){t=o.legends[e][t];t.container.empty(),t.container.html(t.initialHTMLContent)})}),o.$container.removeClass(u),o.$container.removeData(u),o.container=b,o.$container=b,o.options=b,o.paper=b,o.$map=b,o.$tooltip=b,o.mapConf=b,o.areas=b,o.plots=b,o.links=b,o.customEventHandlers=b},initResponsiveSize:function(){function t(t){var e,o=n.$map.width();n.paper.width!==o&&(e=o/n.mapConf.width,n.paper.setSize(o,n.mapConf.height*e),!0!==t&&n.options.legend.redrawOnResize&&n.createLegends("plot",n.plots,e))}var n=this,e=null;n.onResizeEvent=function(){clearTimeout(e),e=setTimeout(function(){t()},n.resizeFilteringTO)},O(window).on("resize."+u,n.onResizeEvent),t(!0)},extendDefaultOptions:function(n){return n=O.extend(!0,{},a.prototype.defaultOptions,n),O.each(["area","plot"],function(t,e){if(O.isArray(n.legend[e]))for(var o=0;o<n.legend[e].length;++o)n.legend[e][o]=O.extend(!0,{},a.prototype.legendDefaultOptions[e],n.legend[e][o]);else n.legend[e]=O.extend(!0,{},a.prototype.legendDefaultOptions[e],n.legend[e])}),n},initDelegatedMapEvents:function(){var a,i,s=this,r={area:s.areas,"area-text":s.areas,plot:s.plots,"plot-text":s.plots,link:s.links,"link-text":s.links};s.$container.on("mouseover."+u,"[data-id]",function(){var n=this;clearTimeout(a),a=setTimeout(function(){var t=O(n),e=t.attr("data-id"),o=t.attr("data-type");r[o]!==b?s.elemEnter(r[o][e]):"legend-elem"!==o&&"legend-label"!==o||(o=t.attr("data-legend-id"),t=t.attr("data-legend-type"),s.elemEnter(s.legends[t][o].elems[e]))},s.MouseOverFilteringTO)}),s.$container.on("mousemove."+u,"[data-id]",function(o){var n=this;clearTimeout(i),i=setTimeout(function(){var t=O(n),e=t.attr("data-id"),t=t.attr("data-type");r[t]!==b&&s.elemHover(r[t][e],o)},0)}),s.$container.on("mouseout."+u,"[data-id]",function(){clearTimeout(a),clearTimeout(i);var t=O(this),e=t.attr("data-id"),o=t.attr("data-type");r[o]!==b?s.elemOut(r[o][e]):"legend-elem"!==o&&"legend-label"!==o||(o=t.attr("data-legend-id"),t=t.attr("data-legend-type"),s.elemOut(s.legends[t][o].elems[e]))}),s.$container.on("click."+u,"[data-id]",function(t,e){var o=O(this),n=o.attr("data-id"),a=o.attr("data-type");r[a]!==b?s.elemClick(r[a][n]):"legend-elem"!==a&&"legend-label"!==a||(a=o.attr("data-legend-id"),o=o.attr("data-legend-type"),s.handleClickOnLegendElem(s.legends[o][a].elems[n],n,a,o,e))})},initDelegatedCustomEvents:function(){var a=this;O.each(a.customEventHandlers,function(n){var t=n+"."+u+".custom";a.$container.off(t).on(t,"[data-id]",function(t){var e=O(this),o=e.attr("data-id"),e=e.attr("data-type").replace("-text","");a.panning||a.customEventHandlers[n][e]===b||a.customEventHandlers[n][e][o]===b||(e=a.customEventHandlers[n][e][o]).options.eventHandlers[n](t,o,e.mapElem,e.textElem,e.options)})})},initElem:function(t,e,o){var n=this,a=O(o.mapElem.node);o.options.href&&(o.options.attrs.cursor="pointer",o.options.text&&(o.options.text.attrs.cursor="pointer")),o.mapElem.attr(o.options.attrs),a.attr({"data-id":t,"data-type":e}),o.options.cssClass!==b&&a.addClass(o.options.cssClass),o.options.text&&o.options.text.content!==b&&(a=n.getTextPosition(o.mapElem.getBBox(),o.options.text.position,o.options.text.margin),o.options.text.attrs.text=o.options.text.content,o.options.text.attrs.x=a.x,o.options.text.attrs.y=a.y,o.options.text.attrs["text-anchor"]=a.textAnchor,o.textElem=n.paper.text(a.x,a.y,o.options.text.content),o.textElem.attr(o.options.text.attrs),O(o.textElem.node).attr({"data-id":t,"data-type":e+"-text"})),o.options.eventHandlers&&n.setEventHandlers(t,e,o),n.setHoverOptions(o.mapElem,o.options.attrs,o.options.attrsHover),o.textElem&&n.setHoverOptions(o.textElem,o.options.text.attrs,o.options.text.attrsHover)},initZoom:function(s,r,p){var l=this,m=!1,c=0,d=0,o={reset:function(){l.$container.trigger("zoom",{level:0})},in:function(){l.$container.trigger("zoom",{level:"+1"})},out:function(){l.$container.trigger("zoom",{level:-1})}};O.extend(l.zoomData,{zoomLevel:0,panX:0,panY:0}),O.each(p.buttons,function(t,e){if(o[t]===b)throw new Error("Unknown zoom button '"+t+"'");e=O("<div>").addClass(e.cssClass).html(e.content).attr("title",e.title);e.on("click."+u,o[t]),l.$map.append(e)}),l.options.map.zoom.mousewheel&&l.$map.on("mousewheel."+u,function(t){var e=0<t.deltaY?1:-1,o=l.mapPagePositionToXY(t.pageX,t.pageY);l.$container.trigger("zoom",{fixedCenter:!0,level:l.zoomData.zoomLevel+e,x:o.x,y:o.y}),t.preventDefault()}),l.options.map.zoom.touch&&(l.$map.on("touchstart."+u,function(t){2===t.originalEvent.touches.length&&(l.zoomCenterX=(t.originalEvent.touches[0].pageX+t.originalEvent.touches[1].pageX)/2,l.zoomCenterY=(t.originalEvent.touches[0].pageY+t.originalEvent.touches[1].pageY)/2,l.previousPinchDist=Math.sqrt(Math.pow(t.originalEvent.touches[1].pageX-t.originalEvent.touches[0].pageX,2)+Math.pow(t.originalEvent.touches[1].pageY-t.originalEvent.touches[0].pageY,2)))}),l.$map.on("touchmove."+u,function(t){var e=0;if(2===t.originalEvent.touches.length){var o=Math.sqrt(Math.pow(t.originalEvent.touches[1].pageX-t.originalEvent.touches[0].pageX,2)+Math.pow(t.originalEvent.touches[1].pageY-t.originalEvent.touches[0].pageY,2));return 15<Math.abs(o-l.previousPinchDist)&&(t=l.mapPagePositionToXY(l.zoomCenterX,l.zoomCenterY),e=(o-l.previousPinchDist)/Math.abs(o-l.previousPinchDist),l.$container.trigger("zoom",{fixedCenter:!0,level:l.zoomData.zoomLevel+e,x:t.x,y:t.y}),l.previousPinchDist=o),!1}})),l.$map.on("dragstart",function(){return!1});var h=null,g=null;O("body").on("mouseup."+u+(p.touch?" touchend."+u:""),function(){m=!1,clearTimeout(h),clearTimeout(g),h=setTimeout(function(){l.panning=!1},l.panningEndFilteringTO)}),l.$map.on("mousedown."+u+(p.touch?" touchstart."+u:""),function(t){clearTimeout(h),clearTimeout(g),t.pageX!==b?(m=!0,c=t.pageX,d=t.pageY):1===t.originalEvent.touches.length&&(m=!0,c=t.originalEvent.touches[0].pageX,d=t.originalEvent.touches[0].pageY)}).on("mousemove."+u+(p.touch?" touchmove."+u:""),function(t){var e=l.zoomData.zoomLevel,o=0,n=0;if(clearTimeout(h),clearTimeout(g),t.pageX!==b?(o=t.pageX,n=t.pageY):1===t.originalEvent.touches.length?(o=t.originalEvent.touches[0].pageX,n=t.originalEvent.touches[0].pageY):m=!1,m&&0!==e){var t=(c-o)/(1+e*p.step)*(s/l.paper.width),e=(d-n)/(1+e*p.step)*(r/l.paper.height),a=Math.min(Math.max(0,l.currentViewBox.x+t),s-l.currentViewBox.w),i=Math.min(Math.max(0,l.currentViewBox.y+e),r-l.currentViewBox.h);return(5<Math.abs(t)||5<Math.abs(e))&&(O.extend(l.zoomData,{panX:a,panY:i,zoomX:a+l.currentViewBox.w/2,zoomY:i+l.currentViewBox.h/2}),l.setViewBox(a,i,l.currentViewBox.w,l.currentViewBox.h),g=setTimeout(function(){l.$map.trigger("afterPanning",{x1:a,y1:i,x2:a+l.currentViewBox.w,y2:i+l.currentViewBox.h})},l.panningFilteringTO),c=o,d=n,l.panning=!0),!1}})},mapPagePositionToXY:function(t,e){var o=this,n=o.$map.offset(),a=o.options.map.width?o.mapConf.width/o.options.map.width:o.mapConf.width/o.$map.width(),i=1/(1+o.zoomData.zoomLevel*o.options.map.zoom.step);return{x:i*a*(t-n.left)+o.zoomData.panX,y:i*a*(e-n.top)+o.zoomData.panY}},onZoomEvent:function(t,e){var o,n,a,i,s,r=this,p=r.zoomData.zoomLevel,l=1+r.zoomData.zoomLevel*r.options.map.zoom.step,m=(e.animDuration!==b?e:r.options.map.zoom).animDuration;if(e.area!==b){if(r.areas[e.area]===b)throw new Error("Unknown area '"+e.area+"'");var c=e.areaMargin!==b?e.areaMargin:10,d=r.areas[e.area].mapElem.getBBox(),h=d.width+2*c,c=d.height+2*c;e.x=d.cx,e.y=d.cy,p=Math.min(Math.floor((r.mapConf.width/h-1)/r.options.map.zoom.step),Math.floor((r.mapConf.height/c-1)/r.options.map.zoom.step))}else if(e.level!==b&&(p="string"==typeof e.level?"+"===e.level.slice(0,1)||"-"===e.level.slice(0,1)?r.zoomData.zoomLevel+parseInt(e.level,10):parseInt(e.level,10):e.level<0?r.zoomData.zoomLevel+e.level:e.level),e.plot!==b){if(r.plots[e.plot]===b)throw new Error("Unknown plot '"+e.plot+"'");e.x=r.plots[e.plot].coords.x,e.y=r.plots[e.plot].coords.y}else e.latitude!==b&&e.longitude!==b&&(s=r.mapConf.getCoords(e.latitude,e.longitude),e.x=s.x,e.y=s.y),e.x===b&&(e.x=r.currentViewBox.x+r.currentViewBox.w/2),e.y===b&&(e.y=r.currentViewBox.y+r.currentViewBox.h/2);s=1+(p=Math.min(Math.max(p,r.options.map.zoom.minLevel),r.options.map.zoom.maxLevel))*r.options.map.zoom.step,a=r.mapConf.width/s,i=r.mapConf.height/s,n=0===p?o=0:(n=e.fixedCenter!==b&&!0===e.fixedCenter?(o=r.zoomData.panX+(e.x-r.zoomData.panX)*(s-l)/s,r.zoomData.panY+(e.y-r.zoomData.panY)*(s-l)/s):(o=e.x-a/2,e.y-i/2),o=Math.min(Math.max(0,o),r.mapConf.width-a),Math.min(Math.max(0,n),r.mapConf.height-i)),s==l&&o===r.zoomData.panX&&n===r.zoomData.panY||(0<m?r.animateViewBox(o,n,a,i,m,r.options.map.zoom.animEasing):(r.setViewBox(o,n,a,i),clearTimeout(r.zoomTO),r.zoomTO=setTimeout(function(){r.$map.trigger("afterZoom",{x1:o,y1:n,x2:o+a,y2:n+i})},r.zoomFilteringTO)),O.extend(r.zoomData,{zoomLevel:p,panX:o,panY:n,zoomX:o+a/2,zoomY:n+i/2}))},onShowElementsInRange:function(t,e){var o=this;e.animDuration===b&&(e.animDuration=0),e.hiddenOpacity===b&&(e.hiddenOpacity=.3),e.ranges&&e.ranges.area&&o.showElemByRange(e.ranges.area,o.areas,e.hiddenOpacity,e.animDuration),e.ranges&&e.ranges.plot&&o.showElemByRange(e.ranges.plot,o.plots,e.hiddenOpacity,e.animDuration),e.ranges&&e.ranges.link&&o.showElemByRange(e.ranges.link,o.links,e.hiddenOpacity,e.animDuration),e.afterShowRange&&e.afterShowRange()},showElemByRange:function(t,a,i,e){var o=this,s={};t.min===b&&t.max===b||(t={0:t}),O.each(t,function(o){var n=t[o];if(n.min===b&&n.max===b)return!0;O.each(a,function(t){var e=a[t].options.value;if("object"!=typeof e&&(e=[e]),e[o]===b)return!0;n.min!==b&&e[o]<n.min||n.max!==b&&e[o]>n.max?s[t]=i:s[t]=1})}),O.each(s,function(t){o.setElementOpacity(a[t],s[t],e)})},setElementOpacity:function(t,e,o){0<e&&(t.mapElem.show(),t.textElem&&t.textElem.show()),this.animate(t.mapElem,{opacity:e},o,function(){0===e&&t.mapElem.hide()}),this.animate(t.textElem,{opacity:e},o,function(){0===e&&t.textElem.hide()})},onUpdateEvent:function(t,e){var n=this;if("object"==typeof e){var o,a,i=0,s=e.animDuration||0,r=function(t){n.animate(t.mapElem,{opacity:0},s,function(){t.mapElem.remove()}),n.animate(t.textElem,{opacity:0},s,function(){t.textElem.remove()})},p=function(t){t.mapElem.attr({opacity:0}),t.textElem&&t.textElem.attr({opacity:0}),n.setElementOpacity(t,t.mapElem.originalAttrs.opacity!==b?t.mapElem.originalAttrs.opacity:1,s)};if("object"==typeof e.mapOptions&&(!0===e.replaceOptions?n.options=n.extendDefaultOptions(e.mapOptions):O.extend(!0,n.options,e.mapOptions),e.mapOptions.areas===b&&e.mapOptions.plots===b&&e.mapOptions.legend===b||O("[data-type='legend-elem']",n.$container).each(function(t,e){"1"===O(e).attr("data-hidden")&&O(e).trigger("click",{hideOtherElems:!1,animDuration:s})})),"object"==typeof e.deletePlotKeys)for(;i<e.deletePlotKeys.length;i++)n.plots[e.deletePlotKeys[i]]!==b&&(r(n.plots[e.deletePlotKeys[i]]),delete n.plots[e.deletePlotKeys[i]]);else"all"===e.deletePlotKeys&&(O.each(n.plots,function(t,e){r(e)}),n.plots={});if("object"==typeof e.deleteLinkKeys)for(i=0;i<e.deleteLinkKeys.length;i++)n.links[e.deleteLinkKeys[i]]!==b&&(r(n.links[e.deleteLinkKeys[i]]),delete n.links[e.deleteLinkKeys[i]]);else"all"===e.deleteLinkKeys&&(O.each(n.links,function(t,e){r(e)}),n.links={});"object"==typeof e.newPlots&&O.each(e.newPlots,function(t){n.plots[t]===b&&(n.options.plots[t]=e.newPlots[t],n.plots[t]=n.drawPlot(t),0<s&&p(n.plots[t]))}),"object"==typeof e.newLinks&&(o=n.drawLinksCollection(e.newLinks),O.extend(n.links,o),O.extend(n.options.links,e.newLinks),0<s&&O.each(o,function(t){p(o[t])})),O.each(n.areas,function(t){("object"==typeof e.mapOptions&&("object"==typeof e.mapOptions.map&&"object"==typeof e.mapOptions.map.defaultArea||"object"==typeof e.mapOptions.areas&&"object"==typeof e.mapOptions.areas[t]||"object"==typeof e.mapOptions.legend&&"object"==typeof e.mapOptions.legend.area)||!0===e.replaceOptions)&&(n.areas[t].options=n.getElemOptions(n.options.map.defaultArea,n.options.areas[t]||{},n.options.legend.area),n.updateElem(n.areas[t],s))}),O.each(n.plots,function(t){("object"==typeof e.mapOptions&&("object"==typeof e.mapOptions.map&&"object"==typeof e.mapOptions.map.defaultPlot||"object"==typeof e.mapOptions.plots&&"object"==typeof e.mapOptions.plots[t]||"object"==typeof e.mapOptions.legend&&"object"==typeof e.mapOptions.legend.plot)||!0===e.replaceOptions)&&(n.plots[t].options=n.getElemOptions(n.options.map.defaultPlot,n.options.plots[t]||{},n.options.legend.plot),n.setPlotCoords(n.plots[t]),n.setPlotAttributes(n.plots[t]),n.updateElem(n.plots[t],s))}),O.each(n.links,function(t){("object"==typeof e.mapOptions&&("object"==typeof e.mapOptions.map&&"object"==typeof e.mapOptions.map.defaultLink||"object"==typeof e.mapOptions.links&&"object"==typeof e.mapOptions.links[t])||!0===e.replaceOptions)&&(n.links[t].options=n.getElemOptions(n.options.map.defaultLink,n.options.links[t]||{},{}),n.updateElem(n.links[t],s))}),e.mapOptions&&("object"==typeof e.mapOptions.legend||"object"==typeof e.mapOptions.map&&"object"==typeof e.mapOptions.map.defaultArea||"object"==typeof e.mapOptions.map&&"object"==typeof e.mapOptions.map.defaultPlot)&&(O("[data-type='legend-elem']",n.$container).each(function(t,e){"1"===O(e).attr("data-hidden")&&O(e).trigger("click",{hideOtherElems:!1,animDuration:s})}),n.createLegends("area",n.areas,1),n.options.map.width?n.createLegends("plot",n.plots,n.options.map.width/n.mapConf.width):n.createLegends("plot",n.plots,n.$map.width()/n.mapConf.width)),"object"==typeof e.setLegendElemsState?O.each(e.setLegendElemsState,function(t,o){t=n.$container.find("."+t)[0];t!==b&&O("[data-type='legend-elem']",t).each(function(t,e){("0"===O(e).attr("data-hidden")&&"hide"===o||"1"===O(e).attr("data-hidden")&&"show"===o)&&O(e).trigger("click",{hideOtherElems:!1,animDuration:s})})}):(a="hide"===e.setLegendElemsState?"hide":"show",O("[data-type='legend-elem']",n.$container).each(function(t,e){("0"===O(e).attr("data-hidden")&&"hide"==a||"1"===O(e).attr("data-hidden")&&"show"==a)&&O(e).trigger("click",{hideOtherElems:!1,animDuration:s})})),n.initDelegatedCustomEvents(),e.afterUpdate&&e.afterUpdate(n.$container,n.paper,n.areas,n.plots,n.options,n.links)}},setPlotCoords:function(t){var e;t.options.x!==b&&t.options.y!==b?t.coords={x:t.options.x,y:t.options.y}:t.options.plotsOn!==b&&this.areas[t.options.plotsOn]!==b?(e=this.areas[t.options.plotsOn].mapElem.getBBox(),t.coords={x:e.cx,y:e.cy}):t.coords=this.mapConf.getCoords(t.options.latitude,t.options.longitude)},setPlotAttributes:function(t){"square"===t.options.type?(t.options.attrs.width=t.options.size,t.options.attrs.height=t.options.size,t.options.attrs.x=t.coords.x-t.options.size/2,t.options.attrs.y=t.coords.y-t.options.size/2):"image"===t.options.type?(t.options.attrs.src=t.options.url,t.options.attrs.width=t.options.width,t.options.attrs.height=t.options.height,t.options.attrs.x=t.coords.x-t.options.width/2,t.options.attrs.y=t.coords.y-t.options.height/2):"svg"===t.options.type?(t.options.attrs.path=t.options.path,t.options.attrs.transform===b&&(t.options.attrs.transform=""),t.mapElem.originalBBox===b&&(t.mapElem.originalBBox=t.mapElem.getBBox()),t.mapElem.baseTransform="m"+t.options.width/t.mapElem.originalBBox.width+",0,0,"+t.options.height/t.mapElem.originalBBox.height+","+(t.coords.x-t.options.width/2)+","+(t.coords.y-t.options.height/2),t.options.attrs.transform=t.mapElem.baseTransform+t.options.attrs.transform):(t.options.attrs.x=t.coords.x,t.options.attrs.y=t.coords.y,t.options.attrs.r=t.options.size/2)},drawLinksCollection:function(n){var a=this,i={},s={},r={},p={},l={};return O.each(n,function(t){var e,o=a.getElemOptions(a.options.map.defaultLink,n[t],{});i="string"==typeof n[t].between[0]?a.options.plots[n[t].between[0]]:n[t].between[0],s="string"==typeof n[t].between[1]?a.options.plots[n[t].between[1]]:n[t].between[1],i.plotsOn!==b&&a.areas[i.plotsOn]!==b?(e=a.areas[i.plotsOn].mapElem.getBBox(),r={x:e.cx,y:e.cy}):i.latitude!==b&&i.longitude!==b?r=a.mapConf.getCoords(i.latitude,i.longitude):(r.x=i.x,r.y=i.y),s.plotsOn!==b&&a.areas[s.plotsOn]!==b?(e=a.areas[s.plotsOn].mapElem.getBBox(),p={x:e.cx,y:e.cy}):s.latitude!==b&&s.longitude!==b?p=a.mapConf.getCoords(s.latitude,s.longitude):(p.x=s.x,p.y=s.y),l[t]=a.drawLink(t,r.x,r.y,p.x,p.y,o)}),l},drawLink:function(t,e,o,n,a,i){var s={options:i},r=(e+n)/2,p=(o+a)/2,l=-1/((a-o)/(n-e)),m=p-l*r,c=Math.sqrt((n-e)*(n-e)+(a-o)*(a-o)),d=1+l*l,h=-2*r+2*l*m-2*l*p,r=h*h-4*d*(r*r+m*m-m*p-p*m+p*p-i.factor*c*(i.factor*c)),p=0,c=0,c=0<i.factor?l*(p=(-h+Math.sqrt(r))/(2*d))+m:l*(p=(-h-Math.sqrt(r))/(2*d))+m;return s.mapElem=this.paper.path("m "+e+","+o+" C "+p+","+c+" "+n+","+a+" "+n+","+a),this.initElem(t,"link",s),s},isAttrsChanged:function(t,e){for(var o in e)if(e.hasOwnProperty(o)&&void 0===t[o]||e[o]!==t[o])return!0;return!1},updateElem:function(t,e){var o,n,a,i=this;!0===t.options.toFront&&t.mapElem.toFront(),t.options.href!==b?(t.options.attrs.cursor="pointer",t.options.text&&(t.options.text.attrs.cursor="pointer")):"pointer"===t.mapElem.attrs.cursor&&(t.options.attrs.cursor="auto",t.options.text&&(t.options.text.attrs.cursor="auto")),t.textElem&&(t.options.text.attrs.text=t.options.text.content,a=t.mapElem.getBBox(),(t.options.size||t.options.width&&t.options.height)&&(n="image"===t.options.type||"svg"===t.options.type?(o=(t.options.width-a.width)/2,(t.options.height-a.height)/2):(o=(t.options.size-a.width)/2,(t.options.size-a.height)/2),a.x-=o,a.x2+=o,a.y-=n,a.y2+=n),a=i.getTextPosition(a,t.options.text.position,t.options.text.margin),t.options.text.attrs.x=a.x,t.options.text.attrs.y=a.y,t.options.text.attrs["text-anchor"]=a.textAnchor,i.setHoverOptions(t.textElem,t.options.text.attrs,t.options.text.attrsHover),i.isAttrsChanged(t.textElem.attrs,t.options.text.attrs)&&i.animate(t.textElem,t.options.text.attrs,e)),i.setHoverOptions(t.mapElem,t.options.attrs,t.options.attrsHover),i.isAttrsChanged(t.mapElem.attrs,t.options.attrs)&&i.animate(t.mapElem,t.options.attrs,e),t.options.cssClass!==b&&O(t.mapElem.node).removeClass().addClass(t.options.cssClass)},drawPlot:function(t){var e=this,o={};return o.options=e.getElemOptions(e.options.map.defaultPlot,e.options.plots[t]||{},e.options.legend.plot),e.setPlotCoords(o),"svg"===o.options.type&&(o.mapElem=e.paper.path(o.options.path)),e.setPlotAttributes(o),"square"===o.options.type?o.mapElem=e.paper.rect(o.options.attrs.x,o.options.attrs.y,o.options.attrs.width,o.options.attrs.height):"image"===o.options.type?o.mapElem=e.paper.image(o.options.attrs.src,o.options.attrs.x,o.options.attrs.y,o.options.attrs.width,o.options.attrs.height):"svg"===o.options.type||(o.mapElem=e.paper.circle(o.options.attrs.x,o.options.attrs.y,o.options.attrs.r)),e.initElem(t,"plot",o),o},setEventHandlers:function(e,o,n){var a=this;O.each(n.options.eventHandlers,function(t){a.customEventHandlers[t]===b&&(a.customEventHandlers[t]={}),a.customEventHandlers[t][o]===b&&(a.customEventHandlers[t][o]={}),a.customEventHandlers[t][o][e]=n})},drawLegend:function(t,e,o,n,a){var i=this,s={},r={},p=0,l=0,m=null,c=null,d={},h=0,g=0,u=0,f=0,x=[],w=(s=O("."+t.cssClass,i.$container)).html();for(s.empty(),r=new B(s.get(0)),O(r.canvas).attr({"data-legend-type":e,"data-legend-id":a}),l=p=0,t.title&&""!==t.title&&(c=(m=r.text(t.marginLeftTitle,0,t.title).attr(t.titleAttrs)).getBBox(),m.attr({y:.5*c.height}),p=t.marginLeftTitle+c.width,l+=t.marginBottomTitle+c.height),h=0;h<t.slices.length;++h){var y=0;x[h]=O.extend(!0,{},"plot"===e?i.options.map.defaultPlot:i.options.map.defaultArea,t.slices[h]),t.slices[h].legendSpecificAttrs===b&&(t.slices[h].legendSpecificAttrs={}),O.extend(!0,x[h].attrs,t.slices[h].legendSpecificAttrs),"area"===e?(x[h].attrs.width===b&&(x[h].attrs.width=30),x[h].attrs.height===b&&(x[h].attrs.height=20)):"square"===x[h].type?(x[h].attrs.width===b&&(x[h].attrs.width=x[h].size),x[h].attrs.height===b&&(x[h].attrs.height=x[h].size)):"image"===x[h].type||"svg"===x[h].type?(x[h].attrs.width===b&&(x[h].attrs.width=x[h].width),x[h].attrs.height===b&&(x[h].attrs.height=x[h].height)):x[h].attrs.r===b&&(x[h].attrs.r=x[h].size/2),y=t.marginBottomTitle,m&&(y+=c.height),"plot"!==e||x[h].type!==b&&"circle"!==x[h].type?y+=n*x[h].attrs.height/2:y+=n*x[h].attrs.r,f=Math.max(f,y)}for("horizontal"===t.mode&&(p=t.marginLeft),h=0;h<x.length;++h){var v,E={},z={},C={};x[h].display!==b&&!0!==x[h].display||("area"===e||"square"===x[h].type?(u="horizontal"===t.mode?(g=p+t.marginLeft,f-.5*n*x[h].attrs.height):(g=t.marginLeft,l),E=r.rect(g,u,n*x[h].attrs.width,n*x[h].attrs.height)):"image"===x[h].type||"svg"===x[h].type?(u="horizontal"===t.mode?(g=p+t.marginLeft,f-.5*n*x[h].attrs.height):(g=t.marginLeft,l),"image"===x[h].type?E=r.image(x[h].url,g,u,n*x[h].attrs.width,n*x[h].attrs.height):(E=r.path(x[h].path),x[h].attrs.transform===b&&(x[h].attrs.transform=""),z=E.getBBox(),x[h].attrs.transform="m"+n*x[h].width/z.width+",0,0,"+n*x[h].height/z.height+","+g+","+u+x[h].attrs.transform)):(u="horizontal"===t.mode?(g=p+t.marginLeft+n*x[h].attrs.r,f):(g=t.marginLeft+n*x[h].attrs.r,l+n*x[h].attrs.r),E=r.circle(g,u,n*x[h].attrs.r)),delete x[h].attrs.width,delete x[h].attrs.height,delete x[h].attrs.r,E.attr(x[h].attrs),z=E.getBBox(),u="horizontal"===t.mode?(g=p+t.marginLeft+z.width+t.marginLeftLabel,f):(g=t.marginLeft+z.width+t.marginLeftLabel,l+z.height/2),C=r.text(g,u,x[h].label).attr(t.labelAttrs),"horizontal"===t.mode?(v=t.marginBottom+z.height,p+=t.marginLeft+z.width+t.marginLeftLabel+C.getBBox().width,"image"!==x[h].type&&"area"!==e&&(v+=t.marginBottomTitle),m&&(v+=c.height),l=Math.max(l,v)):(p=Math.max(p,t.marginLeft+z.width+t.marginLeftLabel+C.getBBox().width),l+=t.marginBottom+z.height),O(E.node).attr({"data-legend-id":a,"data-legend-type":e,"data-type":"legend-elem","data-id":h,"data-hidden":0}),O(C.node).attr({"data-legend-id":a,"data-legend-type":e,"data-type":"legend-label","data-id":h,"data-hidden":0}),d[h]={mapElem:E,textElem:C},t.hideElemsOnClick.enabled&&(C.attr({cursor:"pointer"}),E.attr({cursor:"pointer"}),i.setHoverOptions(E,x[h].attrs,x[h].attrs),i.setHoverOptions(C,t.labelAttrs,t.labelAttrsHover),x[h].clicked!==b&&!0===x[h].clicked&&i.handleClickOnLegendElem(d[h],h,a,e,{hideOtherElems:!1})))}return"SVG"!==B.type&&t.VMLWidth&&(p=t.VMLWidth),r.setSize(p,l),{container:s,initialHTMLContent:w,elems:d}},handleClickOnLegendElem:function(t,e,n,o,a){var i,s=this;a=a||{},i=O.isArray(s.options.legend[o])?s.options.legend[o][n]:s.options.legend[o];var r=t.mapElem,p=t.textElem,t=O(r.node),r=O(p.node),l=i.slices[e],m="area"===o?s.areas:s.plots,c=(a.animDuration!==b?a:i.hideElemsOnClick).animDuration,d=t.attr("data-hidden"),o="0"===d?{"data-hidden":"1"}:{"data-hidden":"0"};"0"===d?s.animate(p,{opacity:.5},c):s.animate(p,{opacity:1},c),O.each(m,function(t){var e,o=m[t].mapElem.data("hidden-by");o===b&&(o={}),e=O.isArray(m[t].options.value)?m[t].options.value[n]:m[t].options.value,s.getLegendSlice(e,i)===l&&("0"===d?(o[n]=!0,s.setElementOpacity(m[t],i.hideElemsOnClick.opacity,c)):(delete o[n],O.isEmptyObject(o)&&s.setElementOpacity(m[t],m[t].mapElem.originalAttrs.opacity!==b?m[t].mapElem.originalAttrs.opacity:1,c)),m[t].mapElem.data("hidden-by",o))}),t.attr(o),r.attr(o),a.hideOtherElems!==b&&!0!==a.hideOtherElems||!0!==i.exclusive||O("[data-type='legend-elem'][data-hidden=0]",s.$container).each(function(){var t=O(this);t.attr("data-id")!==e&&t.trigger("click",{hideOtherElems:!1})})},createLegends:function(t,e,o){var n=this,a=n.options.legend[t];O.isArray(n.options.legend[t])||(a=[n.options.legend[t]]),n.legends[t]={};for(var i=0;i<a.length;++i)!0===a[i].display&&O.isArray(a[i].slices)&&0<a[i].slices.length&&""!==a[i].cssClass&&0!==O("."+a[i].cssClass,n.$container).length&&(n.legends[t][i]=n.drawLegend(a[i],t,e,o,i))},setHoverOptions:function(t,e,o){"SVG"!==B.type&&delete o.transform,t.attrsHover=o,t.attrsHover.transform?t.originalAttrs=O.extend({transform:"s1"},e):t.originalAttrs=e},elemEnter:function(t){var e,o=this;t!==b&&(t.mapElem!==b&&o.animate(t.mapElem,t.mapElem.attrsHover,t.mapElem.attrsHover.animDuration),t.textElem!==b&&o.animate(t.textElem,t.textElem.attrsHover,t.textElem.attrsHover.animDuration),t.options&&t.options.tooltip!==b&&(e="",o.$tooltip.removeClass().addClass(o.options.map.tooltip.cssClass),t.options.tooltip.content!==b&&(e="function"==typeof t.options.tooltip.content?t.options.tooltip.content(t.mapElem):t.options.tooltip.content),t.options.tooltip.cssClass!==b&&o.$tooltip.addClass(t.options.tooltip.cssClass),o.$tooltip.html(e).css("display","block")),t.mapElem===b&&t.textElem===b||o.paper.safari&&o.paper.safari())},elemHover:function(t,e){var o,n,a,i=this;t!==b&&t.options.tooltip!==b&&(o=e.pageX,n=e.pageY,a=10,e=20,"object"==typeof t.options.tooltip.offset&&(void 0!==t.options.tooltip.offset.left&&(a=t.options.tooltip.offset.left),void 0!==t.options.tooltip.offset.top&&(e=t.options.tooltip.offset.top)),e={left:Math.min(i.$map.width()-i.$tooltip.outerWidth()-5,o-i.$map.offset().left+a),top:Math.min(i.$map.height()-i.$tooltip.outerHeight()-5,n-i.$map.offset().top+e)},"object"==typeof t.options.tooltip.overflow&&(!0===t.options.tooltip.overflow.right&&(e.left=o-i.$map.offset().left+10),!0===t.options.tooltip.overflow.bottom&&(e.top=n-i.$map.offset().top+20)),i.$tooltip.css(e))},elemOut:function(t){var e=this;t!==b&&(t.mapElem!==b&&e.animate(t.mapElem,t.mapElem.originalAttrs,t.mapElem.attrsHover.animDuration),t.textElem!==b&&e.animate(t.textElem,t.textElem.originalAttrs,t.textElem.attrsHover.animDuration),t.options&&t.options.tooltip!==b&&e.$tooltip.css({display:"none",top:-1e3,left:-1e3}),t.mapElem===b&&t.textElem===b||e.paper.safari&&e.paper.safari())},elemClick:function(t){t!==b&&(this.panning||t.options.href===b||window.open(t.options.href,t.options.target))},getElemOptions:function(t,e,o){var n=O.extend(!0,{},t,e);if(n.value!==b)if(O.isArray(o))for(var a=0;a<o.length;++a)n=O.extend(!0,{},n,this.getLegendSlice(n.value[a],o[a]));else n=O.extend(!0,{},n,this.getLegendSlice(n.value,o));return n},getTextPosition:function(t,e,o){var n=0,a=0,i="";switch("number"==typeof o&&(o="bottom"===e||"top"===e?{x:0,y:o}:"right"===e||"left"===e?{x:o,y:0}:{x:0,y:0}),e){case"bottom":n=(t.x+t.x2)/2+o.x,a=t.y2+o.y,i="middle";break;case"top":n=(t.x+t.x2)/2+o.x,a=t.y-o.y,i="middle";break;case"left":n=t.x-o.x,a=(t.y+t.y2)/2+o.y,i="end";break;case"right":n=t.x2+o.x,a=(t.y+t.y2)/2+o.y,i="start";break;default:n=(t.x+t.x2)/2+o.x,a=(t.y+t.y2)/2+o.y,i="middle"}return{x:n,y:a,textAnchor:i}},getLegendSlice:function(t,e){for(var o=0;o<e.slices.length;++o)if(e.slices[o].sliceValue!==b&&t===e.slices[o].sliceValue||e.slices[o].sliceValue===b&&(e.slices[o].min===b||t>=e.slices[o].min)&&(e.slices[o].max===b||t<=e.slices[o].max))return e.slices[o];return{}},animateViewBox:function(i,s,r,p,l,t){var m=this,c=m.currentViewBox.x,d=i-c,h=m.currentViewBox.y,g=s-h,u=m.currentViewBox.w,f=r-u,x=m.currentViewBox.h,w=p-x;m.zoomAnimCVBTarget||(m.zoomAnimCVBTarget={x:i,y:s,w:r,h:p});var y=r<u?"in":"out",v=B.easing_formulas[t||"linear"],E=l-2*l/100,z=m.zoomAnimStartTime;m.zoomAnimStartTime=(new Date).getTime();var C=function(){m.cancelAnimationFrame(m.zoomAnimID);var t,e,o,n,a=(new Date).getTime()-m.zoomAnimStartTime;a<E?(z&&m.zoomAnimCVBTarget&&m.zoomAnimCVBTarget.w!==r?(o=(new Date).getTime()-z,n=v(o/l),t=c+(m.zoomAnimCVBTarget.x-c)*n,e=h+(m.zoomAnimCVBTarget.y-h)*n,o=u+(m.zoomAnimCVBTarget.w-u)*n,n=x+(m.zoomAnimCVBTarget.h-x)*n,d=i-(c=t),g=s-(h=e),f=r-(u=o),w=p-(x=n),m.zoomAnimCVBTarget={x:i,y:s,w:r,h:p}):(a=v(a/l),t=c+d*a,e=h+g*a,o=u+f*a,n=x+w*a),"in"==y&&(o>m.currentViewBox.w||o<r)||"out"==y&&(o<m.currentViewBox.w||r<o)||m.setViewBox(t,e,o,n),m.zoomAnimID=m.requestAnimationFrame(C)):(m.zoomAnimStartTime=null,m.zoomAnimCVBTarget=null,m.currentViewBox.w!==r&&m.setViewBox(i,s,r,p),m.$map.trigger("afterZoom",{x1:i,y1:s,x2:i+r,y2:s+p}))};C()},requestAnimationFrame:function(t){return this._requestAnimationFrameFn.call(window,t)},cancelAnimationFrame:function(t){this._cancelAnimationFrameFn.call(window,t)},_requestAnimationFrameFn:(o=(new Date).getTime(),n=function(t){var e=(new Date).getTime();if(!(16<e-o))return setTimeout(function(){n(t)},0);t(o=e)},window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.msRequestAnimationFrame||window.oRequestAnimationFrame||n),_cancelAnimationFrameFn:window.cancelAnimationFrame||window.webkitCancelAnimationFrame||window.webkitCancelRequestAnimationFrame||window.mozCancelAnimationFrame||window.mozCancelRequestAnimationFrame||window.msCancelAnimationFrame||window.msCancelRequestAnimationFrame||window.oCancelAnimationFrame||window.oCancelRequestAnimationFrame||clearTimeout,setViewBox:function(t,e,o,n){var a=this;a.currentViewBox.x=t,a.currentViewBox.y=e,a.currentViewBox.w=o,a.currentViewBox.h=n,a.paper.setViewBox(t,e,o,n,!1)},_nonAnimatedAttrs:["arrow-end","arrow-start","gradient","class","cursor","text-anchor","font","font-family","font-style","font-weight","letter-spacing","src","href","target","title","stroke-dasharray","stroke-linecap","stroke-linejoin","stroke-miterlimit"],animate:function(t,e,o,n){if(t)if(0<o){for(var a={},i=0;i<this._nonAnimatedAttrs.length;i++){var s=this._nonAnimatedAttrs[i];e[s]!==b&&(a[s]=e[s])}t.attr(a),t.animate(e,o,"linear",function(){n&&n()})}else t.attr(e),n&&n()},isRaphaelBBoxBugPresent:function(){var t=this.paper.text(-50,-50,"TEST"),e=t.getBBox();return t.remove(),0===e.width&&0===e.height},defaultOptions:{map:{cssClass:"map",tooltip:{cssClass:"mapTooltip"},defaultArea:{attrs:{fill:"#343434",stroke:"#5d5d5d","stroke-width":1,"stroke-linejoin":"round"},attrsHover:{fill:"#f38a03",animDuration:300},text:{position:"inner",margin:10,attrs:{"font-size":15,fill:"#c7c7c7"},attrsHover:{fill:"#eaeaea",animDuration:300}},target:"_self",cssClass:"area"},defaultPlot:{type:"circle",size:15,attrs:{fill:"#0088db",stroke:"#fff","stroke-width":0,"stroke-linejoin":"round"},attrsHover:{"stroke-width":3,animDuration:300},text:{position:"right",margin:10,attrs:{"font-size":15,fill:"#c7c7c7"},attrsHover:{fill:"#eaeaea",animDuration:300}},target:"_self",cssClass:"plot"},defaultLink:{factor:.5,attrs:{stroke:"#0088db","stroke-width":2},attrsHover:{animDuration:300},text:{position:"inner",margin:10,attrs:{"font-size":15,fill:"#c7c7c7"},attrsHover:{fill:"#eaeaea",animDuration:300}},target:"_self",cssClass:"link"},zoom:{enabled:!1,minLevel:0,maxLevel:10,step:.25,mousewheel:!0,touch:!0,animDuration:200,animEasing:"linear",buttons:{reset:{cssClass:"zoomButton zoomReset",content:"&#8226;",title:"Reset zoom"},in:{cssClass:"zoomButton zoomIn",content:"+",title:"Zoom in"},out:{cssClass:"zoomButton zoomOut",content:"&#8722;",title:"Zoom out"}}}},legend:{redrawOnResize:!0,area:[],plot:[]},areas:{},plots:{},links:{}},legendDefaultOptions:{area:{cssClass:"areaLegend",display:!0,marginLeft:10,marginLeftTitle:5,marginBottomTitle:10,marginLeftLabel:10,marginBottom:10,titleAttrs:{"font-size":16,fill:"#343434","text-anchor":"start"},labelAttrs:{"font-size":12,fill:"#343434","text-anchor":"start"},labelAttrsHover:{fill:"#787878",animDuration:300},hideElemsOnClick:{enabled:!0,opacity:.2,animDuration:300},slices:[],mode:"vertical"},plot:{cssClass:"plotLegend",display:!0,marginLeft:10,marginLeftTitle:5,marginBottomTitle:10,marginLeftLabel:10,marginBottom:10,titleAttrs:{"font-size":16,fill:"#343434","text-anchor":"start"},labelAttrs:{"font-size":12,fill:"#343434","text-anchor":"start"},labelAttrsHover:{fill:"#787878",animDuration:300},hideElemsOnClick:{enabled:!0,opacity:.2,animDuration:300},slices:[],mode:"vertical"}}},a.version="2.2.0",O[u]===b&&(O[u]=a),O.fn[u]=function(t){return this.each(function(){O.data(this,u)&&O.data(this,u).destroy(),O.data(this,u,new a(this,t))})},a});